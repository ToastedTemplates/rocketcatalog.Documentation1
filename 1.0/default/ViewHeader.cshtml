@inherits RocketCatalog.Components.RocketCatalogTokens<Simplisity.SimplisityRazor>
@using DNNrocketAPI;
@using Simplisity;
@using RocketCatalog.Components;
@using DNNrocketAPI.Components;

@{
    var portalCatalog = (PortalCatalogLimpet)Model.List.First();
    var remoteParam = (RemoteLimpet)Model.GetDataObject("remoteparam");
    var paramInfo = (SimplisityInfo)Model.GetDataObject("paraminfo");

    var remoteParamItem = "";
    var moduleId = Model.ModuleId;
    var tabId = Model.TabId;
    // We need the moduleid, the first remote call will have the moduleid, subsequent call need to have the remote module passed by simplsityparam fields.
    // The remote data assignments needs to be on every template header, so multiple remote modules on the same page work.
    if (remoteParam != null)
    {
        moduleId = remoteParam.ModuleId;
        tabId = remoteParam.TabId;
        remoteParamItem = GeneralUtils.EnCode(remoteParam.Record.ToXmlItem());
    }
    var articleid = 0;
    if (GeneralUtils.IsNumeric(remoteParam.RemoteKey))
    {
        articleid = Convert.ToInt32(remoteParam.RemoteKey);
    }
}

@if (articleid > 0)
{
    // we have a remote key passed, we may need to read the article and do some SEO

    //var articleData = new ArticleLimpet(articleid, remoteParam.CultureCode);

}


<script type="text/javascript" src="/DesktopModules/DNNrocket/Simplisity/js/simplisity.js"></script>
<script type="text/javascript" src="@(portalCatalog.EngineUrlWithProtocol)/DesktopModules/RocketThemes/rocketcatalog/@(portalCatalog.AppTheme.AppThemeFolder)/@(portalCatalog.AppTheme.AppVersionFolder)/js/frontend.js"></script>

<link rel="stylesheet" href="/DesktopModules/DNNrocket/fa/css/all.min.css">
<link rel="stylesheet" href="/DesktopModules/DNNrocket/css/w3.css">
<link rel="stylesheet" href="@(portalCatalog.EngineUrlWithProtocol)/DesktopModules/RocketThemes/rocketcatalog/@(portalCatalog.AppTheme.AppThemeFolder)/@(portalCatalog.AppTheme.AppVersionFolder)/css/AgenceSesame.css">

<script type="text/javascript" src="@(portalCatalog.EngineUrlWithProtocol)/DesktopModules/RocketThemes/rocketcatalog/@(portalCatalog.AppTheme.AppThemeFolder)/@(portalCatalog.AppTheme.AppVersionFolder)/js/jquery.cookie.js"></script>
<script type="text/javascript" src="@(portalCatalog.EngineUrlWithProtocol)/DesktopModules/RocketThemes/rocketcatalog/@(portalCatalog.AppTheme.AppThemeFolder)/@(portalCatalog.AppTheme.AppVersionFolder)/js/jquery.treegrid.min.js"></script>
<link rel="stylesheet" href="@(portalCatalog.EngineUrlWithProtocol)/DesktopModules/RocketThemes/rocketcatalog/@(portalCatalog.AppTheme.AppThemeFolder)/@(portalCatalog.AppTheme.AppVersionFolder)/css/jquery.treegrid.css">


<script>

    $(document).ready(function () {

        $(document).simplisityStartUp('@(portalCatalog.EngineUrlWithProtocol)/Desktopmodules/dnnrocket/api/rocket/action', { systemkey: 'rocketcatalog', debug: false });

    });

    function sendRemoteParams@(moduleId)() {
        // send remoteParam back to the server, so we keep all the config data.
        // We place this in a function so if we have multiple remote modules, the correct data is set on the s-before.
        // FOR MULTIPLE MODULES or SESSION DATA: This function MUST be called on the "s-before" simplisty event, on each button call.
        simplisity_setParamField('remotecall', 'true');
        simplisity_setParamField('remoteparams', '@(remoteParamItem)');
    }

</script>

