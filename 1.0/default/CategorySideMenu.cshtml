@inherits RocketCatalog.Components.RocketCatalogTokens<Simplisity.SimplisityRazor>
@using DNNrocketAPI;
@using Simplisity;
@using RocketCatalog.Components;
@using DNNrocketAPI.Components;


@AddProcessData("resourcepath", "/DesktopModules/DNNrocket/api/App_LocalResources/")
@AddProcessData("resourcepath", "/DesktopModules/DNNrocketModules/RocketCatalog/App_LocalResources/")

@{
    var categoryDataList = (CategoryLimpetList)Model.GetDataObject("categorydatalist");
    var sessionParams = (SessionParams)Model.SessionParamsData;
    var selectedcolor = "";
    var portalCatalog = new PortalCatalogLimpet(categoryDataList.PortalId, categoryDataList.CultureCode);
}

<div class="w3-bar-block w3-theme-l4">
    <a href="@sessionParams.PageUrl" catid="0" class="ajaxcategory w3-bar-item w3-button w3-theme">
        @ResourceKey("RC.all")
    </a>

    <table class="categorytree">
        @foreach (var categoryData in categoryDataList.GetCategoryTree())
        {
            selectedcolor = "";
            var toplevelclass = "";
            if (sessionParams.GetInt("searchcategoryid") == categoryData.CategoryId)
            {
                selectedcolor = "w3-theme";
            }
            else
            {
                if (categoryData.Level == 0)
                {
                    toplevelclass = "catlevel1";
                }
            }

            var parentclass = "";
            if (categoryData.ParentItemId > 0)
            {
                parentclass = "treegrid-parent-" + categoryData.ParentItemId;
            }
            var productListUrl = sessionParams.PageUrl + categoryData.UrlTokens(portalCatalog.ArticleListPageUrl);

        <tr class="treegrid-@(categoryData.CategoryId)  @(parentclass) ">
            <td></td>
            <td pushurl="@productListUrl" class="ajaxcategory" catid="@categoryData.CategoryId" style="width:100%" >
                <a href="@productListUrl" class="" style="pointer-events: none;">@categoryData.Name</a>
            </td>
        </tr>
        }
    </table>

</div>

<script>

    $(document).ready(function () {

        // CATEGORY EVENTS
        $('.ajaxcategory').unbind("click");
        $('.ajaxcategory').click(function (event) {
            event.preventDefault();

            // add to browser bar and history
            var stateObj = { "": "" };
            history.pushState(stateObj, "Title", $(this).attr('pushurl'));

            // we need "SearchBanner.cshtml" to be loaded on the page.
            $('#searchcategoryid').val($(this).attr("catid"));
            $('.triggersearch').trigger('click');

        });

    });

</script>
